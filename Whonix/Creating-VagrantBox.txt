# To create a Vagrant box from an existing VM instance:

# Initialize generic Vagrant environment. Make sure VM has virtualbox provider
vagrant init generic/debian11

# Start and stop Vagrant to generate .vagrant/machines/default/virtualbox/id
vagrant up && vagrant halt

# Replace generic vagrant machine ID with the ID of the VM you want to package. Replace <vm-short-name. with the name of the running virtual machine
echo -n `VBoxManage list vms | grep <vm-short-name> | sed 's/.*{\(.*\)}[^{]*$/\1/'` > .vagrant/machines/default/virtualbox/id

# You can now start the VM and make any adjustments before packaging the machine into a box
vagrant up

# Package vagrant into a box file
vagrant package --output <box-name>.box

# Add box to local repo
vagrant box add <box-name> <box-name>.box
